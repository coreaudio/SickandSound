<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Buchungen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="style.css" />
  <style>
    table{width:100%}
    th,td{padding:8px}
    .row-actions{display:flex;gap:8px}
  </style>
</head>
<body>
<div class="app">
  <header class="appbar"><div class="app-title"><div class="brand-dot"></div><h1>Buchungen</h1></div></header>

  <main class="content">
    <div class="card">
      <div class="footer" style="gap:8px;flex-wrap:wrap">
        <button class="btn" onclick="addBooking()">âž• Manuell hinzufÃ¼gen</button>
        <button class="btn danger" onclick="clearAll()">ðŸ—‘ Alles lÃ¶schen</button>
      </div>
    </div>

    <div class="card table-wrap">
      <table>
        <thead><tr><th>Datum</th><th>Person</th><th>Summe (â‚¬)</th><th></th></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </main>

  <nav class="bottomnav">
    <a class="tab" href="index.html"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 6h16v2H4zM4 11h16v2H4zM4 16h10v2H4z"/></svg><span>Liste</span></a>
    <a class="tab" href="hausdienst.html"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3l9 7-1.2 1.6L18 10.1V20h-5v-6H11v6H6v-9.9L4.2 11.6 3 10z"/></svg><span>Hausdienst</span></a>
    <a class="tab" href="rangliste.html"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 17H3V7h4v10zm7 0h-4V3h4v14zm7 0h-4v-8h4v8z"/></svg><span>Rang</span></a>
    <a class="tab" href="badges.html"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 1l3.09 6.26L22 8.27l-5 4.87L18.18 22 12 18.56 5.82 22 7 13.14 2 8.27l6.91-1.01L12 1z"/></svg><span>Badges</span></a>
    <a class="tab active" href="buchungen.html"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 2h9l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm8 1.5V8h4.5L14 3.5z"/></svg><span>Buchungen</span></a>
  </nav>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig={apiKey:"AIzaSyBFHjGXI5yHyK0DyupS0bnTVAqlu6lvpNw",authDomain:"sickandsound-e9704.firebaseapp.com",projectId:"sickandsound-e9704",storageBucket:"sickandsound-e9704.firebasestorage.app",messagingSenderId:"248197359659",appId:"1:248197359659:web:a8777cbed3f83d6b1ca26e",measurementId:"G-62LH8V7S2E"};
let db=null; try{firebase.initializeApp(firebaseConfig); try{firebase.analytics();}catch(_){ } db=firebase.firestore();}catch(_){db=null;}
const STATE_COLLECTION = location.search.includes("beta") ? "state_beta" : "state";

let bookings=[];
function euro(n){ return Number(n||0).toFixed(2).replace('.',','); }

function render(){
  const tb=document.getElementById('tbody');
  tb.innerHTML = bookings.map((b,i)=>`
    <tr>
      <td>${b.date||'-'}</td>
      <td>${b.person||'-'}</td>
      <td>${euro(b.sum||0)}</td>
      <td class="row-actions"><button class="btn danger small" onclick="del(${i})">LÃ¶schen</button></td>
    </tr>
  `).join('') || '<tr><td colspan="4" class="sub">Keine Buchungen</td></tr>';
}
function save(){
  localStorage.setItem('sick_sound_bookings',JSON.stringify(bookings||[]));
  if(db){ db.collection(STATE_COLLECTION).doc("global").set({bookings},{merge:true}); }
}
function del(i){ bookings.splice(i,1); save(); render(); }
function clearAll(){ if(!confirm("Alle Buchungen lÃ¶schen?")) return; bookings=[]; save(); render(); }
function addBooking(){
  const person = prompt("Person?"); if(!person) return;
  const sum = parseFloat(prompt("Summe (â‚¬)?")||"0"); if(!sum) return;
  const date=new Date().toLocaleDateString("de-DE");
  bookings.push({date,person,sum}); save(); render();
}
async function load(){
  if(db){
    const s=await db.collection(STATE_COLLECTION).doc("global").get();
    bookings = s.exists ? (s.data().bookings||[]) : (JSON.parse(localStorage.getItem('sick_sound_bookings')||'[]')||[]);
    render();
    db.collection(STATE_COLLECTION).doc("global").onSnapshot(snap=>{
      if(!snap.exists) return;
      bookings = snap.data().bookings || bookings; render();
    });
  }else{
    bookings = JSON.parse(localStorage.getItem('sick_sound_bookings')||'[]')||[]; render();
  }
}
if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js').catch(()=>{}); }
load();
</script>
</body>
</html>

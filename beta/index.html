<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Sick & Sound â€“ Strichliste</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0e14" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&display=swap" rel="stylesheet" />
</head>
<body>
<div class="app">

  <!-- AppBar -->
  <header class="appbar">
    <div class="app-title">
      <div class="brand-dot"></div>
      <h1>Sick &amp; Sound</h1>
    </div>
    <div class="appbar-actions">
      <button class="btn small dark" onclick="togglePayPal()">ðŸ’¸</button>
      <button class="btn small" onclick="openDrinkModal()">âž•</button>
    </div>
  </header>

  <!-- Content -->
  <main class="content">
    <div class="card" style="margin-bottom:12px">
      <div class="section-title">Heute</div>
      <div id="todayInfo" class="sub">Lade Tagesstatusâ€¦</div>
    </div>

    <div class="card table-wrap" id="tableContainer"></div>

    <div class="card" style="margin-top:12px">
      <div class="section-title">Aktionen</div>
      <div class="footer">
        <button class="btn warning" id="undoBtn" onclick="undoLast()">â†© RÃ¼ckgÃ¤ngig</button>
        <button class="btn secondary" id="redoBtn" onclick="redoLast()">â†ª Wiederholen</button>
        <button class="btn danger" id="deleteBtn" onclick="toggleDeleteMode()">ðŸ—‘ LÃ¶schen</button>
        <button class="btn dark" onclick="resetAll()">â™» Abrechnen & zurÃ¼cksetzen</button>
        <button class="btn ghost" onclick="window.location='buchungen.html'">ðŸ“– Buchungen</button>
      </div>
    </div>
  </main>

  <!-- BottomNav -->
  <nav class="bottomnav">
    <a class="tab active" href="index.html" aria-label="Strichliste">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 6h16v2H4zM4 11h16v2H4zM4 16h10v2H4z"/></svg>
      <span>Liste</span>
    </a>
    <a class="tab" href="hausdienst.html" aria-label="Hausdienst">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3l9 7-1.2 1.6L18 10.1V20h-5v-6H11v6H6v-9.9L4.2 11.6 3 10z"/></svg>
      <span>Hausdienst</span>
    </a>
    <a class="tab" href="rangliste.html" aria-label="Ranglisten">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 17H3V7h4v10zm7 0h-4V3h4v14zm7 0h-4v-8h4v8z"/></svg>
      <span>Rang</span>
    </a>
    <a class="tab" href="buchungen.html" aria-label="Buchungen">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 2h9l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm8 1.5V8h4.5L14 3.5z"/></svg>
      <span>Buchungen</span>
    </a>
  </nav>
</div>

<!-- Modals -->
<div class="modal" id="paypalModal" onclick="togglePayPal()"><img class="qr" src="frame.png" alt="PayPal QR"></div>

<div class="modal" id="personModal"><div class="box">
  <h2>âž• Person hinzufÃ¼gen</h2>
  <input id="personName" placeholder="Name eintippen" />
  <div style="display:flex;gap:10px;margin-top:10px">
    <button class="btn" onclick="confirmAddPerson()">Speichern</button>
    <button class="btn dark" onclick="closeModal('personModal')">Abbrechen</button>
  </div>
</div></div>

<div class="modal" id="drinkModal"><div class="box">
  <h2>ðŸ¥¤ GetrÃ¤nk hinzufÃ¼gen</h2>
  <input id="drinkName" placeholder="Name des GetrÃ¤nks">
  <input id="drinkPrice" type="number" step="0.1" placeholder="Preis (â‚¬)">
  <div style="display:flex;gap:10px;margin-top:10px">
    <button class="btn" onclick="confirmAddDrink()">Speichern</button>
    <button class="btn dark" onclick="closeModal('drinkModal')">Abbrechen</button>
  </div>
</div></div>

<!-- Firebase + Howler -->
<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/howler@2.2.4/dist/howler.core.min.js"></script>

<script>
/* ===== Config ===== */
const CORE = ["Chris","Daniel","Elmi","Florian","Joel","Kevin","Kiste","Marco","Meli","Simon"];
const firebaseConfig={apiKey:"AIzaSyBFHjGXI5yHyK0DyupS0bnTVAqlu6lvpNw",authDomain:"sickandsound-e9704.firebaseapp.com",projectId:"sickandsound-e9704",storageBucket:"sickandsound-e9704.firebasestorage.app",messagingSenderId:"248197359659",appId:"1:248197359659:web:a8777cbed3f83d6b1ca26e",measurementId:"G-62LH8V7S2E"};
firebase.initializeApp(firebaseConfig); firebase.analytics(); const db=firebase.firestore();

/* ===== Prod/Beta Datenspeicher ===== */
const STATE_COLLECTION = location.search.includes("beta") ? "state_beta" : "state";

/* ===== State ===== */
const pricesKey="sick_sound_prices", peopleKey="sick_sound_people", dataKey="sick_sound_data",
      historyKey="sick_sound_history", bookingsKey="sick_sound_bookings", orderKey="sick_sound_order",
      xpKey="sick_sound_xp", redoKey="sick_sound_redo";
let prices={"Cola_Zero":1.0,"Monster":1.5,"Wasser":0.5,"Kaffee":1.0,"Mittagessen":6.0};
let people=[], data={}, history=[], redoStack=[], bookings=[], columnOrder=Object.keys(prices), xp={};
let deleteMode=false, hdToday=null;

/* ===== Sounds & Level helpers ===== */
const sClick=new Howl({src:["https://cdn.jsdelivr.net/gh/jshawl/howler-examples@master/audio/sfx/coin1.wav"]});
const sLevel=new Howl({src:["https://cdn.jsdelivr.net/gh/jshawl/howler-examples@master/audio/sfx/powerUp5.wav"]});
const todayStr=()=>new Date().toISOString().slice(0,10);
const levelOf=x=>Math.floor(Math.sqrt(x/20))+1;
const lvlMin=l=>20*(l-1)*(l-1), lvlNext=l=>20*l*l;

/* ===== Long-press for +1 ===== */
let holdT=null, holdI=null;
function startHold(handler){ stopHold(); handler(); holdT=setTimeout(()=>{holdI=setInterval(handler,120)},420); }
function stopHold(){ if(holdT) clearTimeout(holdT); if(holdI) clearInterval(holdI); holdT=holdI=null; }
window.onmouseup=stopHold; window.onmouseleave=stopHold;

/* ===== Load ===== */
async function loadState(){
  try{
    const snap=await db.collection(STATE_COLLECTION).doc("global").get();
    if(snap.exists){
      const s=snap.data();
      prices=s.prices||prices;
      people=s.people||JSON.parse(localStorage.getItem(peopleKey))||[];
      data=s.data||data;
      history=s.history||history;
      redoStack=s.redoStack||JSON.parse(localStorage.getItem(redoKey))||[];
      bookings=s.bookings||bookings;
      columnOrder=s.columnOrder||Object.keys(prices);
      xp=s.xp||xp;
    }else{
      people=JSON.

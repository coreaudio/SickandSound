<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Strichliste</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">

  <h1>Strichliste</h1>

  <!-- Navigation -->
  <div class="nav-container">
    <button onclick="window.location.href='buchungen.html'">Buchungen</button>
    <button onclick="window.location.href='hausdienst.html'">Rangliste</button>
  </div>

  <!-- Tabelle -->
  <table id="drinkTable">
    <thead>
      <tr>
        <th>Person</th>
        <th>Cola</th>
        <th>Wasser</th>
        <th>Bier</th>
      </tr>
    </thead>
    <tbody id="personBody">
      <tr><td>Anna</td><td>0</td><td>0</td><td>0</td></tr>
      <tr><td>Ben</td><td>0</td><td>0</td><td>0</td></tr>
      <tr><td>Chris</td><td>0</td><td>0</td><td>0</td></tr>
    </tbody>
  </table>

  <!-- Buttons unten -->
  <div class="button-container">
    <button class="add" onclick="addColumn()">Add+</button>
    <button onclick="addPerson()">+</button>
    <button onclick="resetTable()">Reset</button>
    <button onclick="undoReset()">Rückgängig</button>
    <button class="delete-mode" onclick="toggleDeleteMode()">Löschen</button>
  </div>

</div>

<script>
let deleteMode = false;
let resetHistory = [];

function addColumn() {
  const table = document.getElementById("drinkTable");
  const colName = prompt("Name des neuen Getränks?");
  if (!colName) return;

  // Neue Spalte ins Header
  const th = document.createElement("th");
  th.innerText = colName;
  th.onclick = () => { if(deleteMode) confirmDeleteColumn(th.cellIndex); };
  table.rows[0].appendChild(th);

  // Neue Spalte für jede Person
  for (let i = 1; i < table.rows.length; i++) {
    const td = document.createElement("td");
    td.innerText = "0";
    table.rows[i].appendChild(td);
  }
}

function addPerson() {
  const tbody = document.getElementById("personBody");
  const name = prompt("Name der Person?");
  if (!name) return;

  const table = document.getElementById("drinkTable");
  const row = document.createElement("tr");
  const tdName = document.createElement("td");
  tdName.innerText = name;
  row.appendChild(tdName);

  // Leerspalten für Getränke
  for (let i = 1; i < table.rows[0].cells.length; i++) {
    const td = document.createElement("td");
    td.innerText = "0";
    row.appendChild(td);
  }

  row.onclick = () => { if(deleteMode) confirmDeleteRow(row); };
  tbody.appendChild(row);

  sortTable();
}

function resetTable() {
  const tbody = document.getElementById("personBody");
  const rows = tbody.rows;
  let log = [];
  for (let r of rows) {
    let sum = 0;
    for (let i = 1; i < r.cells.length; i++) {
      sum += parseInt(r.cells[i].innerText);
      r.cells[i].innerText = "0";
    }
    log.push({person: r.cells[0].innerText, sum: sum});
  }
  const date = new Date().toLocaleDateString("de-DE");
  resetHistory.push({date: date, entries: log});
  localStorage.setItem("buchungen", JSON.stringify(resetHistory));
}

function undoReset() {
  if (resetHistory.length === 0) return;
  resetHistory.pop();
  localStorage.setItem("buchungen", JSON.stringify(resetHistory));
}

function toggleDeleteMode() {
  deleteMode = !deleteMode;
  alert(deleteMode ? "Löschen-Modus aktiviert: Klick auf Person oder Spalte" : "Löschen-Modus deaktiviert");
}

function confirmDeleteRow(row) {
  if (confirm("Person wirklich löschen?")) row.remove();
}

function confirmDeleteColumn(index) {
  if (confirm("Getränk wirklich löschen?")) {
    const table = document.getElementById("drinkTable");
    for (let r of table.rows) {
      r.deleteCell(index);
    }
  }
}

function sortTable() {
  const tbody = document.getElementById("personBody");
  let rows = Array.from(tbody.rows);
  rows.sort((a, b) => a.cells[0].innerText.localeCompare(b.cells[0].innerText));
  rows.forEach(r => tbody.appendChild(r));
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Sick & Sound Strichliste</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Tabelle -->
  <div id="tableContainer" style="flex-grow:1; overflow:auto;"></div>

  <!-- Buttons unten -->
  <div class="footer">
    <button class="btn add" onclick="openDrinkModal()">➕ Getränk</button>
    <button class="btn undo" onclick="undoLast()">↩ Rückgängig</button>
    <button class="btn paypal" onclick="togglePayPal()">💸 PayPal</button>
    <button id="deleteBtn" class="btn delete" onclick="toggleDeleteMode()">🗑 Löschen</button>
    <button class="btn reset" onclick="resetAll()">♻ Alle zurücksetzen</button>
    <button class="btn" style="background:#444; color:#fff;" onclick="window.location='buchungen.html'">📖 Buchungen</button>
    <button class="btn" style="background:#444; color:#fff;" onclick="openHausdienstModal()">🏠 Hausdienst</button>
  </div>

  <!-- PayPal Modal -->
  <div id="paypalModal" class="modal" onclick="togglePayPal()">
    <img src="frame.png" alt="PayPal QR">
  </div>

  <!-- Hausdienst Modal -->
  <div id="hausdienstModal" class="modal">
    <div class="modal-content">
      <h2>🏠 Hausdienst</h2>
      <div class="modal-buttons">
        <button class="btn" style="background:#00c9a7; color:#000;" onclick="window.location='hausdienst.html'">🏆 Rangliste</button>
        <button class="btn" style="background:#444; color:#fff;" onclick="window.location='hausdienst_checklist.html'">📋 Checkliste</button>
      </div>
      <br>
      <button class="btn reset" onclick="closeModal('hausdienstModal')">Abbrechen</button>
    </div>
  </div>

  <!-- Person hinzufügen Modal -->
  <div id="personModal" class="modal">
    <div class="modal-content">
      <h2>➕ Neue Person</h2>
      <input id="personName" type="text" placeholder="Name eingeben">
      <div class="modal-buttons">
        <button class="btn add" onclick="confirmAddPerson()">Speichern</button>
        <button class="btn reset" onclick="closeModal('personModal')">Abbrechen</button>
      </div>
    </div>
  </div>

  <!-- Getränk hinzufügen Modal -->
  <div id="drinkModal" class="modal">
    <div class="modal-content">
      <h2>🥤 Neues Getränk</h2>
      <input id="drinkName" type="text" placeholder="Name des Getränks">
      <input id="drinkPrice" type="number" step="0.1" placeholder="Preis (€)">
      <div class="modal-buttons">
        <button class="btn add" onclick="confirmAddDrink()">Speichern</button>
        <button class="btn reset" onclick="closeModal('drinkModal')">Abbrechen</button>
      </div>
    </div>
  </div>

  <!-- Firebase-Compat-SDKs -->
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore-compat.js"></script>

  <script>
    // Delete-Mode-Flag
    var deleteMode = false;

    // Firebase initialisieren
    var firebaseConfig = {
      apiKey: "AIzaSyBFHjGXI5yHyK0DyupS0bnTVAqlu6lvpNw",
      authDomain: "sickandsound-e9704.firebaseapp.com",
      projectId: "sickandsound-e9704",
      storageBucket: "sickandsound-e9704.firebasestorage.app",
      messagingSenderId: "248197359659",
      appId: "1:248197359659:web:a8777cbed3f83d6b1ca26e",
      measurementId: "G-62LH8V7S2E"
    };
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    var db = firebase.firestore();

    // Keys & Default-State
    var pricesKey     = "sick_sound_prices";
    var peopleKey     = "sick_sound_people";
    var dataKey       = "sick_sound_data";
    var historyKey    = "sick_sound_history";
    var bookingsKey   = "sick_sound_bookings";
    var hausdienstKey = "sick_sound_hausdienst";
    var orderKey      = "sick_sound_order";

    var prices      = { "Cola_Zero":1.0, "Monster":1.5, "Wasser":0.5, "Kaffee":1.0, "Mittagessen":6.0 };
    var people      = [];
    var data        = {};
    var history     = [];
    var bookings    = [];
    var hausdienst  = { current:null, stats:{} };
    var columnOrder = [];

    // State laden (Firestore → Fallback lokal)
    function loadState() {
      db.collection("state").doc("global").get().then(function(snap) {
        if (snap.exists) {
          var s = snap.data();
          prices      = s.prices      || prices;
          people      = s.people      || JSON.parse(localStorage.getItem(peopleKey)) || [];
          data        = s.data        || data;
          history     = s.history     || history;
          bookings    = s.bookings    || bookings;
          hausdienst  = s.hausdienst  || hausdienst;
          columnOrder = s.columnOrder || Object.keys(prices);
        } else {
          people      = JSON.parse(localStorage.getItem(peopleKey)) || [];
          columnOrder = Object.keys(prices);
          saveAll();

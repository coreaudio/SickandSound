<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Buchungs- und Hausdienstliste</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .person { padding: 10px; margin: 5px 0; border: 1px solid #ccc; cursor: pointer; }
    .highlight { box-shadow: 0 0 10px #666; }
    .gold { background: gold; }
    .silver { background: silver; }
    .bronze { background: #cd7f32; color: white; }
    .hausdienst { border: 2px solid red; font-weight: bold; }
    button { margin: 5px; padding: 8px 15px; }
  </style>
</head>
<body>
  <h1>Buchungen & Hausdienst</h1>
  
  <h2>Personen</h2>
  <div id="personenListe"></div>

  <h2>Hausdienst auswählen</h2>
  <select id="hausdienstSelect"></select>
  <button onclick="setHausdienst()">Hausdienst festlegen</button>
  <p id="aktuellerHausdienst"></p>

  <h2>Aktionen</h2>
  <button onclick="reset()">Reset</button>
  <button onclick="undo()">Rückgängig</button>
  <br><br>
  <button onclick="window.location.href='buchungen.html'">Zur Buchungsliste</button>
  <button onclick="window.location.href='hausdienst.html'">Zur Hausdienst-Rangliste</button>

  <script>
    let personen = ["Anna", "Ben", "Clara", "David", "Eva"];
    let summen = {};
    let buchungen = JSON.parse(localStorage.getItem("buchungen")) || [];
    let hausdienstHistory = JSON.parse(localStorage.getItem("hausdienstHistory")) || [];
    let aktuellerHausdienst = localStorage.getItem("aktuellerHausdienst") || "";

    // Init Summen
    personen.forEach(p => { summen[p] = 0; });

    function renderPersonen() {
      let container = document.getElementById("personenListe");
      container.innerHTML = "";
      personen.forEach((p, i) => {
        let div = document.createElement("div");
        div.className = "person";
        div.textContent = p + " → " + summen[p] + "€";
        if (p === aktuellerHausdienst) div.classList.add("hausdienst");
        container.appendChild(div);
      });
      markTop3();
    }

    function markTop3() {
      let ranking = [...personen].sort((a, b) => getHausdienstCount(b) - getHausdienstCount(a));
      let top3 = ranking.slice(0, 3);
      document.querySelectorAll(".person").forEach(div => {
        div.classList.remove("gold","silver","bronze");
        if (div.textContent.startsWith(top3[0])) div.classList.add("gold");
        if (div.textContent.startsWith(top3[1])) div.classList.add("silver");
        if (div.textContent.startsWith(top3[2])) div.classList.add("bronze");
      });
    }

    function getHausdienstCount(p) {
      return hausdienstHistory.filter(h => h.person === p).length;
    }

    function setHausdienst() {
      let p = document.getElementById("hausdienstSelect").value;
      aktuellerHausdienst = p;
      localStorage.setItem("aktuellerHausdienst", p);

      hausdienstHistory.push({person: p, datum: new Date().toLocaleDateString("de-DE")});
      localStorage.setItem("hausdienstHistory", JSON.stringify(hausdienstHistory));

      document.getElementById("aktuellerHausdienst").innerText = "Aktueller Hausdienst: " + p;
      renderPersonen();
    }

    function reset() {
      let sum = 0;
      for (let p in summen) sum += summen[p];
      let eintrag = {datum: new Date().toLocaleDateString("de-DE"), person: aktuellerHausdienst, summe: sum};
      buchungen.push(eintrag);
      localStorage.setItem("buchungen", JSON.stringify(buchungen));
      alert("Buchung gespeichert!");
    }

    function undo() {
      buchungen.pop();
      localStorage.setItem("buchungen", JSON.stringify(buchungen));
      alert("Letzte Buchung entfernt!");
    }

    function init() {
      renderPersonen();
      let select = document.getElementById("hausdienstSelect");
      personen.forEach(p => {
        let opt = document.createElement("option");
        opt.value = p; opt.textContent = p;
        select.appendChild(opt);
      });
      if (aktuellerHausdienst) {
        document.getElementById("aktuellerHausdienst").innerText = "Aktueller Hausdienst: " + aktuellerHausdienst;
      }
    }
    init();
  </script>
</body>
</html>

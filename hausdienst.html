import tkinter as tk
from tkinter import messagebox, ttk
import random

# --- Initialdaten ---
schueler = [
    "Anna", "Ben", "Carla", "David", "Ella",
    "Finn", "Greta", "Henry", "Ida", "Jonas"
]

punkte = {name: 0 for name in schueler}
letzte_aktionen = []  # speichert die letzten Hausdienste (für Rückgängig)

# --- Funktionen ---
def hausdienst_ziehen():
    """Zufällig Schüler ziehen, Punkte vergeben und in Historie speichern."""
    if not schueler:
        messagebox.showinfo("Info", "Keine Schüler verfügbar!")
        return

    gezogen = random.choice(schueler)
    punkte[gezogen] += 1
    letzte_aktionen.append(gezogen)  # merken, falls Rückgängig gedrückt wird

    update_liste()
    messagebox.showinfo("Hausdienst", f"{gezogen} wurde für den Hausdienst ausgewählt!")

def rueckgaengig():
    """Letzte Hausdienst-Aktion rückgängig machen."""
    if not letzte_aktionen:
        messagebox.showwarning("Warnung", "Keine Aktion zum Rückgängig machen!")
        return

    letzter = letzte_aktionen.pop()
    if punkte[letzter] > 0:
        punkte[letzter] -= 1

    update_liste()
    messagebox.showinfo("Rückgängig", f"Die Auswahl von {letzter} wurde rückgängig gemacht.")

def update_liste():
    """Hausdienst-Liste nach Rang sortieren und anzeigen."""
    for row in tree.get_children():
        tree.delete(row)

    # Sortierung: Nach Punkten (absteigend), bei Gleichstand nach Name
    sortiert = sorted(punkte.items(), key=lambda x: (-x[1], x[0]))

    for platz, (name, score) in enumerate(sortiert, start=1):
        tree.insert("", "end", values=(platz, name, score))

# --- GUI Setup ---
root = tk.Tk()
root.title("Hausdienst-Liste")

frame = tk.Frame(root)
frame.pack(pady=10)

btn_ziehen = tk.Button(frame, text="Hausdienst ziehen", command=hausdienst_ziehen)
btn_ziehen.grid(row=0, column=0, padx=5)

btn_rueck = tk.Button(frame, text="Rückgängig", command=rueckgaengig)
btn_rueck.grid(row=0, column=1, padx=5)

# Treeview für Rangliste
tree = ttk.Treeview(root, columns=("Platz", "Name", "Punkte"), show="headings", height=10)
tree.heading("Platz", text="Platz")
tree.heading("Name", text="Name")
tree.heading("Punkte", text="Punkte")

tree.column("Platz", width=50, anchor="center")
tree.column("Name", width=120, anchor="center")
tree.column("Punkte", width=80, anchor="center")

tree.pack(pady=10)

update_liste()

root.mainloop()
